name: SMAPI Mod Template Generator

on:
  workflow_dispatch:

jobs:
  generate:
    runs-on: ubuntu-latest

    steps:
    # 1Ô∏è‚É£ Repo klonen
    - name: Checkout repo
      uses: actions/checkout@v4

    # 2Ô∏è‚É£ .NET 6 installieren
    - name: Setup .NET 6
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '6.0.x'

    # 3Ô∏è‚É£ Tools installieren
    - name: Install tools
      run: sudo apt-get update && sudo apt-get install -y jq

    # 4Ô∏è‚É£ Output Ordner vorbereiten
    - name: Prepare folders
      run: |
        mkdir -p ModBuilder/output/temp_build
        mkdir -p ModBuilder/output/build

    # 5Ô∏è‚É£ Class Library erstellen (leer)
    - name: Create class library
      run: |
        cd ModBuilder/output/temp_build
        dotnet new classlib -n MyModTemplate

    # 6Ô∏è‚É£ Solution erstellen und Projekt hinzuf√ºgen
    - name: Create solution and add project
      run: |
        cd ModBuilder/output/temp_build
        dotnet new sln -n MyModTemplate
        dotnet sln MyModTemplate.sln add MyModTemplate/MyModTemplate.csproj

    # 7Ô∏è‚É£ Pathoschild Package hinzuf√ºgen
    - name: Add SMAPI ModBuildConfig package
      run: |
        cd ModBuilder/output/temp_build/MyModTemplate
        dotnet add package Pathoschild.Stardew.ModBuildConfig --version 4.4.0

    # 8Ô∏è‚É£ Leere Dateien erzeugen (ModEntry.cs und manifest.json)
    - name: Create empty ModEntry.cs and manifest.json
      run: |
        touch ModBuilder/output/temp_build/MyModTemplate/ModEntry.cs
        touch ModBuilder/output/temp_build/MyModTemplate/manifest.json

    # 9Ô∏è‚É£ Alles in den finalen Output kopieren
    - name: Copy template to build output
      run: |
        cp -r ModBuilder/output/temp_build/MyModTemplate ModBuilder/output/build/

    # üîü Optional: Commit & Push (sicher)
    - name: Commit and push template
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        cd $GITHUB_WORKSPACE
        git fetch origin main
        git reset --hard origin/main
        if [ -n "$(git status --porcelain ModBuilder/output/build)" ]; then
          git add ModBuilder/output/build
          git commit -m "Generated MyModTemplate template at $(date +'%Y-%m-%d %H:%M:%S')"
          git push origin main
        else
          echo "Nothing to commit"
