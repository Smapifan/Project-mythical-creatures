name: SMAPI Mod Template Builder

on:
  workflow_dispatch:

jobs:
  template:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup .NET 6
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '6.0.x'

      - name: Create structure
        run: |
          mkdir -p output/MySmapiMod
          cd output
          dotnet new sln -n MySmapiMod
          dotnet new classlib -n MySmapiMod
          dotnet sln MySmapiMod.sln add MySmapiMod/MySmapiMod.csproj

      - name: Add SMAPI package
        run: |
          cd output/MySmapiMod
          dotnet add package Pathoschild.Stardew.ModBuildConfig --version 4.4.0

      - name: Create ModEntry.cs
        run: |
          printf '%s\n' \
          'using StardewModdingAPI;' \
          '' \
          'namespace MySmapiMod' \
          '{' \
          '    public class ModEntry : Mod' \
          '    {' \
          '        public override void Entry(IModHelper helper)' \
          '        {' \
          '            Monitor.Log("Mod loaded!", LogLevel.Info);' \
          '        }' \
          '    }' \
          '}' \
          > output/MySmapiMod/ModEntry.cs

      - name: Create manifest.json
        run: |
          printf '%s\n' \
          '{' \
          '  "Name": "MySmapiMod",' \
          '  "Author": "Smapifan",' \
          '  "Version": "1.0.0",' \
          '  "Description": "Generated SMAPI mod template",' \
          '  "UniqueID": "Smapifan.MySmapiMod",' \
          '  "EntryDll": "MySmapiMod.dll",' \
          '  "MinimumApiVersion": "4.0.0"' \
          '}' \
          > output/MySmapiMod/manifest.json

      - name: Zip result
        run: |
          cd output
          zip -r MySmapiMod-template.zip MySmapiMod MySmapiMod.sln

      - name: Upload
        uses: actions/upload-artifact@v4
        with:
          name: smapi-mod-template
          path: output/MySmapiMod-template.zip
