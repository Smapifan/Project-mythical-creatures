name: SMAPI Mod Template Builder

on:
  workflow_dispatch:

jobs:
  template:
    runs-on: ubuntu-latest

    steps:
    # 1Ô∏è‚É£ Repo klonen
    - name: Checkout
      uses: actions/checkout@v4

    # 2Ô∏è‚É£ .NET 6
    - name: Setup .NET 6
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '6.0.x'

    # 3Ô∏è‚É£ Mod-Name
    - name: Set mod name
      run: |
        echo "MOD_NAME=MySmapiMod" >> $GITHUB_ENV
        echo "AUTHOR=Smapifan" >> $GITHUB_ENV

    # 4Ô∏è‚É£ Ordner anlegen
    - name: Create structure
      run: |
        mkdir -p output/$MOD_NAME
        cd output
        dotnet new sln -n $MOD_NAME
        cd $MOD_NAME
        dotnet new classlib -n $MOD_NAME

    # 5Ô∏è‚É£ Solution mit Projekt verkn√ºpfen
    - name: Link csproj to sln
      run: |
        cd output/$MOD_NAME
        dotnet sln add $MOD_NAME/$MOD_NAME.csproj

    # 6Ô∏è‚É£ SMAPI NuGet installieren
    - name: Add SMAPI build package
      run: |
        cd output/$MOD_NAME/$MOD_NAME
        dotnet add package Pathoschild.Stardew.ModBuildConfig --version 4.4.0

    # 7Ô∏è‚É£ ModEntry.cs erzeugen
    - name: Create ModEntry.cs
      run: |
        cat <<EOF > output/$MOD_NAME/$MOD_NAME/ModEntry.cs
using StardewModdingAPI;

namespace $MOD_NAME
{
    public class ModEntry : Mod
    {
        public override void Entry(IModHelper helper)
        {
            Monitor.Log("Mod loaded successfully!", LogLevel.Info);
        }
    }
}
EOF

    # 8Ô∏è‚É£ manifest.json erzeugen
    - name: Create manifest.json
      run: |
        cat <<EOF > output/$MOD_NAME/$MOD_NAME/manifest.json
{
  "Name": "$MOD_NAME",
  "Author": "$AUTHOR",
  "Version": "1.0.0",
  "Description": "Generated SMAPI mod template",
  "UniqueID": "$AUTHOR.$MOD_NAME",
  "EntryDll": "$MOD_NAME.dll",
  "MinimumApiVersion": "4.0.0"
}
EOF

    # 9Ô∏è‚É£ ZIP bauen
    - name: Zip template
      run: |
        cd output
        zip -r "$MOD_NAME-template.zip" "$MOD_NAME"

    # üîü Artifact hochladen
    - name: Upload template
      uses: actions/upload-artifact@v4
      with:
        name: smapi-mod-template
        path: output/*.zip
